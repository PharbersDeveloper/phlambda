{
   "Comment" : "Pharbers Resource Creation",
   "StartAt" : "StartState",
   "States" : {
      "StartState" : {
         "Type" : "Pass",
         "ResultPath" : null,
         "Next" : "ArgsValidation"
      },
      "ArgsValidation" : {
         "Type" : "Task",
         "Resource" : "arn:aws-cn:lambda:cn-northwest-1:444603803904:function:lmd-phresourceargsvalidation-dev",
         "ResultPath" : null,
         "Next" : "Actions",
         "Catch" : [ {
            "ErrorEquals" : [ "States.Runtime" ],
            "ResultPath" : "$.error",
            "Next" : "CleanUp"
         }, {
            "ErrorEquals" : [ "States.TaskFailed" ],
            "ResultPath" : "$.error",
            "Next" : "CleanUp"
         }, {
            "ErrorEquals" : [ "States.ALL" ],
            "ResultPath" : "$.error",
            "Next" : "CleanUp"
         } ]
      },
      "Actions" : {
         "Type" : "Task",
         "Resource" : "arn:aws-cn:lambda:cn-northwest-1:444603803904:function:lmd-phutilsaction-dev",
         "Parameters" : {
            "traceId.$" : "$.common.traceId",
            "projectId.$" : "$.common.projectId",
            "owner.$" : "$.common.owner",
            "showName.$" : "$.common.showName",
            "jobCat.$" : "$.action.cat",
            "jobDesc.$" : "$.action.desc",
            "message.$": "$.action.message",
            "comments.$" : "$.action.comments",
            "required.$" : "$.action.required"
         },
         "ResultPath" : null,
         "Next" : "ResourceCreation"
      },
      "SuccessMessage" : {
         "Type" : "Task",
         "Resource" : "arn:aws-cn:lambda:cn-northwest-1:444603803904:function:lmd-phconvertmessagesuccess-dev",
         "Parameters" : {
            "traceId.$" : "$.common.traceId",
            "projectId.$" : "$.common.projectId",
            "owner.$" : "$.common.owner",
            "showName.$" : "$.common.showName",
            "flowVersion.$" : "$.common.flowVersion",
            "dagName.$" : "$.common.dagName",
            "projectName.$" : "$.common.projectName",
            "result.$":  "$.result",
            "jobCat.$" : "$.action.cat",
            "jobDesc.$" : "$.action.desc",
            "comments.$" : "$.action.comments"
         },
         "ResultPath" : "$.message",
         "Next" : "Success"
      },
      "ResouceLink" : {
         "Type" : "Task",
         "Resource" : "arn:aws-cn:lambda:cn-northwest-1:444603803904:function:lmd-phresourcelinkcreation-dev",
         "Parameters" : {
            "traceId.$": "$.common.traceId",
            "projectId.$": "$.common.projectId",
            "projectName.$": "$.common.projectName",
            "owner.$": "$.common.owner",
            "flowVersion.$": "$.common.flowVersion",
            "showName.$": "$.common.showName",
            "datasets.$": "$.result.datasets",
            "script.$": "$.result.script"
         },
         "ResultPath" : null,
         "Next" : "SuccessMessage",
         "Catch" : [ {
            "ErrorEquals" : [ "States.Runtime" ],
            "ResultPath" : "$.error",
            "Next" : "CleanUp"
         }, {
            "ErrorEquals" : [ "States.TaskFailed" ],
            "ResultPath" : "$.error",
            "Next" : "CleanUp"
         }, {
            "ErrorEquals" : [ "States.ALL" ],
            "ResultPath" : "$.error",
            "Next" : "CleanUp"
         } ]
      },
      "ResourceCreation" : {
         "Type" : "Parallel",
         "InputPath" : "$",
         "ResultSelector": {
            "datasets.$": "$.[0].datasets",
            "script.$": "$.[1].script"
         },
         "ResultPath": "$.result",
         "Next" : "ResouceLink",
         "Branches" : [
            {
               "StartAt": "DSCreation",
               "States": {
                  "DSCreation": {
                     "Type": "Task",
                     "Resource": "arn:aws-cn:lambda:cn-northwest-1:444603803904:function:lmd-phresourcedatasetcreation-dev",
                     "Parameters": {
                        "traceId.$": "$.common.traceId",
                        "projectId.$": "$.common.projectId",
                        "projectName.$": "$.common.projectName",
                        "owner.$": "$.common.owner",
                        "showName.$": "$.common.showName",
                        "datasets.$": "$.datasets"
                     },
                     "ResultPath": "$.datasets",
                     "End": true
                  }
               }
            },
            {
               "StartAt" : "ScriptsCreation",
               "States" : {
                  "ScriptsCreation" : {
                     "Type" : "Task",
                     "Resource" : "arn:aws-cn:lambda:cn-northwest-1:444603803904:function:lmd-phresourcescriptindexcreation-dev",
                     "Parameters" : {
                        "traceId.$" : "$.common.traceId",
                        "projectId.$" : "$.common.projectId",
                        "projectName.$" : "$.common.projectName",
                        "owner.$" : "$.common.owner",
                        "showName.$" : "$.common.showName",
                        "script.$" : "$.script"
                     },
                     "ResultPath" : "$.script",
                     "Next" : "ScriptsFilesCreation"
                  },
                  "ScriptsFilesCreation" : {
                     "Type" : "Choice",
                     "InputPath" : "$",
                     "Choices" : [ {
                        "Variable" : "$.script.runtime",
                        "StringEquals" : "pyspark",
                        "Next" : "PysparkFiles"
                     }, {
                        "Variable" : "$.script.runtime",
                        "StringEquals" : "python",
                        "Next" : "PythonFiles"
                     }, {
                        "Variable" : "$.script.runtime",
                        "StringEquals" : "r",
                        "Next" : "RFiles"
                     }, {
                        "Variable" : "$.script.runtime",
                        "StringEquals" : "sparkr",
                        "Next" : "SparkrFiles"
                     } ],
                     "Default" : "PysparkFiles"
                  },
                  "PythonFiles" : {
                     "Type" : "Task",
                     "Resource" : "arn:aws-cn:lambda:cn-northwest-1:444603803904:function:lmd-phresourcepythoncreation-dev",
                     "Parameters" : {
                        "traceId.$" : "$.common.traceId",
                        "projectId.$" : "$.common.projectId",
                        "owner.$" : "$.common.owner",
                        "showName.$" : "$.common.showName",
                        "script.$" : "$.script"
                     },
                     "ResultPath": "$.script",
                     "End" : true
                  },
                  "RFiles" : {
                     "Type" : "Task",
                     "Resource" : "arn:aws-cn:lambda:cn-northwest-1:444603803904:function:lmd-phresoucercreation-dev",
                     "Parameters" : {
                        "traceId.$" : "$.common.traceId",
                        "projectId.$" : "$.common.projectId",
                        "owner.$" : "$.common.owner",
                        "showName.$" : "$.common.showName",
                        "script.$" : "$.script"
                     },
                     "ResultPath": "$.script",
                     "End" : true
                  },
                  "SparkrFiles" : {
                     "Type" : "Task",
                     "Resource" : "arn:aws-cn:lambda:cn-northwest-1:444603803904:function:lmd-phresourcesparkrcreation-dev",
                     "Parameters" : {
                        "traceId.$" : "$.common.traceId",
                        "projectId.$" : "$.common.projectId",
                        "owner.$" : "$.common.owner",
                        "showName.$" : "$.common.showName",
                        "script.$" : "$.script"
                     },
                     "ResultPath": "$.script",
                     "End" : true
                  },
                  "PysparkFiles" : {
                     "Type" : "Task",
                     "Resource" : "arn:aws-cn:lambda:cn-northwest-1:444603803904:function:lmd-phresourcepysparkcreation-dev",
                     "Parameters" : {
                        "traceId.$" : "$.common.traceId",
                        "projectId.$" : "$.common.projectId",
                        "owner.$" : "$.common.owner",
                        "showName.$" : "$.common.showName",
                        "script.$" : "$.script"
                     },
                     "ResultPath": "$.script",
                     "End" : true
                  }
               }
         } ],
         "Catch" : [ {
            "ErrorEquals" : [ "States.Runtime" ],
            "ResultPath" : "$.error",
            "Next" : "CleanUp"
         }, {
            "ErrorEquals" : [ "States.TaskFailed" ],
            "ResultPath" : "$.error",
            "Next" : "CleanUp"
         }, {
            "ErrorEquals" : [ "States.ALL" ],
            "ResultPath" : "$.error",
            "Next" : "CleanUp"
         } ]
      },
      "Success" : {
         "Type" : "Task",
         "Resource" : "arn:aws-cn:lambda:cn-northwest-1:444603803904:function:lmd-phutilsnotification-dev",
         "Parameters" : {
            "traceId.$" : "$.common.traceId",
            "projectId.$" : "$.common.projectId",
            "owner.$" : "$.common.owner",
            "showName.$" : "$.common.showName",
            "flowVersion.$" : "$.common.flowVersion",
            "dagName.$" : "$.common.dagName",
            "projectName.$" : "$.common.projectName",
            "jobCat.$" : "$.action.cat",
            "jobDesc.$" : "$.action.desc",
            "comments.$" : "$.action.comments",
            "message.$" : "$.message",
            "status" : "succeed"
         },
         "End" : true
      },
      "CleanUp" : {
         "Type" : "Task",
         "Resource" : "arn:aws-cn:lambda:cn-northwest-1:444603803904:function:lmd-phresourcefiledcleanup-dev",
         "Parameters" : {
            "traceId.$" : "$.common.traceId",
            "projectId.$" : "$.common.projectId",
            "owner.$" : "$.common.owner",
            "showName.$" : "$.common.showName",
            "projectName.$" : "$.common.projectName",
            "datasets.$" : "$.datasets",
            "errors.$" : "$.error",
            "result.$": "$.result",
            "script.$" : "$.script"
         },
         "ResultPath" : "$.message",
         "Next" : "Failed"
      },
      "Failed" : {
         "Type" : "Task",
         "Resource" : "arn:aws-cn:lambda:cn-northwest-1:444603803904:function:lmd-phutilsnotification-dev",
         "Parameters" : {
            "traceId.$" : "$.common.traceId",
            "projectId.$" : "$.common.projectId",
            "owner.$" : "$.common.owner",
            "showName.$" : "$.common.showName",
            "flowVersion.$" : "$.common.flowVersion",
            "dagName.$" : "$.common.dagName",
            "projectName.$" : "$.common.projectName",
            "jobCat.$" : "$.action.cat",
            "jobDesc.$" : "$.action.desc",
            "comments.$" : "$.action.comments",
            "message.$" : "$.message",
            "status" : "failed"
         },
         "End" : true
      }
   }
}